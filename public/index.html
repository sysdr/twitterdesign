<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitter Geographic Distribution Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #e3f2fd;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .dashboard {
            display: grid;
            gap: 20px;
        }
        .section {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
        }
        .regions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        .region-card {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #4CAF50;
        }
        .status-healthy { border-color: #4CAF50; }
        .status-degraded { border-color: #FF9800; }
        .status-failing { border-color: #F44336; }
        .metric {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        .latency-good { color: #4CAF50; }
        .latency-warning { color: #FF9800; }
        .latency-bad { color: #F44336; }
        .refresh-btn {
            background-color: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .refresh-btn:hover {
            background-color: #1565c0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üåç Twitter Geographic Distribution System</h1>
        <p>Multi-Region Architecture with Intelligent Traffic Routing</p>
    </div>

    <button class="refresh-btn" onclick="refreshData()">üîÑ Refresh Data</button>

    <div class="dashboard">
        <div class="section">
            <h3>üìä Regional Status</h3>
            <div class="regions-grid" id="regions-container">
                <!-- Regions will be populated here -->
            </div>
        </div>

        <div class="section">
            <h3>üì¶ CDN Cache Statistics</h3>
            <div class="regions-grid" id="cdn-container">
                <!-- CDN stats will be populated here -->
            </div>
        </div>
    </div>

    <script>
        async function fetchRegions() {
            try {
                const response = await fetch('/api/regions');
                const regions = await response.json();
                displayRegions(regions);
            } catch (error) {
                console.error('Error fetching regions:', error);
            }
        }

        async function fetchCDNStats() {
            try {
                const response = await fetch('/api/cdn-stats');
                const stats = await response.json();
                displayCDNStats(stats);
            } catch (error) {
                console.error('Error fetching CDN stats:', error);
            }
        }

        function displayRegions(regions) {
            const container = document.getElementById('regions-container');
            container.innerHTML = '';

            regions.forEach(region => {
                const card = document.createElement('div');
                card.className = `region-card status-${region.status}`;
                
                const latencyClass = region.latency < 50 ? 'latency-good' : 
                                   region.latency < 100 ? 'latency-warning' : 'latency-bad';

                card.innerHTML = `
                    <h4>${region.name}</h4>
                    <div class="metric">
                        <span>Status:</span>
                        <span>${region.status}</span>
                    </div>
                    <div class="metric">
                        <span>Latency:</span>
                        <span class="${latencyClass}">${region.latency}ms</span>
                    </div>
                    <div class="metric">
                        <span>Active Users:</span>
                        <span>${region.activeUsers.toLocaleString()}</span>
                    </div>
                    <div class="metric">
                        <span>Capacity:</span>
                        <span>${region.capacity.toLocaleString()}</span>
                    </div>
                    <div class="metric">
                        <span>Utilization:</span>
                        <span>${Math.round((region.activeUsers / region.capacity) * 100)}%</span>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function displayCDNStats(stats) {
            const container = document.getElementById('cdn-container');
            container.innerHTML = '';

            Object.entries(stats).forEach(([region, data]) => {
                const card = document.createElement('div');
                card.className = 'region-card';
                
                card.innerHTML = `
                    <h4>${region.toUpperCase()}</h4>
                    <div class="metric">
                        <span>Cache Size:</span>
                        <span>${data.size} items</span>
                    </div>
                    <div class="metric">
                        <span>Hit Rate:</span>
                        <span>${Math.round(data.hitRate * 100)}%</span>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function refreshData() {
            fetchRegions();
            fetchCDNStats();
        }

        // Initial load
        refreshData();

        // Auto-refresh every 5 seconds
        setInterval(refreshData, 5000);
    </script>
</body>
</html>
